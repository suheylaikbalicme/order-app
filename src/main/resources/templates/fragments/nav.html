<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>

<div th:fragment="topbar(pageTitle)">
    <header class="topbar">
        <div class="topbar-inner">
            <div class="brand">
                <a href="/" class="brand-link">
                    <img src="/img/logo.png" th:attr="alt=${appBrandName}" alt="mr-CRM" class="brand-logo">
                    <div class="brand-text">
                        <div class="title" th:text="${appBrandName}">mr-CRM</div>
                        <div class="page" th:text="${pageTitle}">Sayfa</div>
                    </div>
                </a>
            </div>

            <nav class="nav">
                <!-- MenÃ¼ler login olmadan gÃ¶rÃ¼nmesin -->
                <div sec:authorize="isAuthenticated()" style="display:contents;">
                    <a href="/dashboard">Dashboard</a>

                    <div class="dropdown">
                        <button class="nav-link" type="button">SatÄ±ÅŸ <span class="caret">â–¾</span></button>
                        <div class="dropdown-menu">
                            <a href="/offers">Teklifler</a>
                            <a href="/offers/new" sec:authorize="hasAnyRole('ADMIN','USER')">Yeni Teklif</a>
                            <div class="dropdown-sep"></div>
                            <a href="/orders">SipariÅŸler</a>
                            <a href="/orders/new" sec:authorize="hasAnyRole('ADMIN','USER')">Yeni SipariÅŸ</a>
                        </div>
                    </div>

                    <div class="dropdown">
                        <button class="nav-link" type="button">MÃ¼ÅŸteriler <span class="caret">â–¾</span></button>
                        <div class="dropdown-menu">
                            <a href="/customers">MÃ¼ÅŸterileri GÃ¶rÃ¼ntÃ¼le</a>
                            <a href="/customers/new" sec:authorize="hasAnyRole('ADMIN','USER')">Yeni MÃ¼ÅŸteri Ekle</a>
                            <a href="/customers/import" sec:authorize="hasAnyRole('ADMIN','USER')">Logoâ€™dan Ä°Ã§e Aktar</a>
                        </div>
                    </div>

                    <a href="/admin/sync" sec:authorize="hasRole('ADMIN')">Sync</a>

                    <div class="dropdown" sec:authorize="hasRole('ADMIN')">
                        <button class="nav-link" type="button">YÃ¶netim <span class="caret">â–¾</span></button>
                        <div class="dropdown-menu">
                            <a href="/admin/users">KullanÄ±cÄ±lar</a>
                            <a href="/admin/roles">Roller &amp; Yetkiler</a>
                            <a href="/admin/settings">Sistem AyarlarÄ±</a>
                            <div class="dropdown-sep"></div>
                            <a href="/admin/audit">Audit Log</a>
                        </div>
                    </div>


                    <div class="right">
                        <div class="dropdown" sec:authorize="isAuthenticated()">
                            <button class="pill" type="button">
                                <span class="avatar-sm">
                                    <img src="/avatars/me" alt="avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-flex';">
                                    <span class="avatar-fallback" style="display:none;">ðŸ‘¤</span>
                                </span>
                                <span sec:authentication="name">user</span>
                                <span class="caret">â–¾</span>
                            </button>
                            <div class="dropdown-menu dropdown-menu-right">
                                <a href="/profile">HesabÄ±m</a>
                                <div class="dropdown-sep"></div>
                                <a href="/logout">Ã‡Ä±kÄ±ÅŸ</a>
                            </div>
                        </div>
                    </div>
                </div>

                <a href="/login" sec:authorize="!isAuthenticated()">GiriÅŸ</a>
            </nav>
        </div>
    </header>

    <!-- âœ… Confirm sistemi sadece login sonrasÄ± yÃ¼klensin -->
    <div sec:authorize="isAuthenticated()">

        <!-- Confirm Modal -->
        <div id="confirmModal">
            <div class="modal-overlay"></div>
            <div class="modal-box">
                <h3 data-modal-title>Onay</h3>
                <p class="muted" data-modal-message>Emin misiniz?</p>
                <div class="row" style="justify-content:flex-end; margin-top:14px;">
                    <button class="btn" data-modal-cancel>VazgeÃ§</button>
                    <button class="btn danger" data-modal-ok>Devam</button>
                </div>
            </div>
        </div>

        <!-- âœ… TEK script + cache-bust -->
        <script src="/ui.js?v=4" defer></script>
    </div>
</div>

</body>
</html>
